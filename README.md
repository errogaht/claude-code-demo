# Каскадное управление паровыми котлами

Реализация алгоритма каскадного управления для 4 паровых котлов на языке Structured Text (IEC 61131-3) для среды Codesys.

## Структура проекта

```
src/
├── DUT/                          # Структуры данных (Data Unit Types)
│   ├── ST_BoilerData.st         # Данные котла
│   ├── ST_CascadeParams.st      # Параметры каскада
│   └── ST_CascadeStatus.st      # Статус каскада
├── FB/                           # Функциональные блоки
│   └── FB_CascadeControl.st     # Основной блок каскадного управления
└── PRG/                          # Программы
    └── PRG_Main.st              # Главная программа
```

## Основные возможности

- Автоматическое распределение нагрузки между 4 котлами
- Поддержание давления в паропроводе ±0.02 МПа
- Система приоритетов (1-4, где 1 - наивысший)
- Плавное изменение мощности резервных котлов (ramping)
- Защита от частых пусков/остановов (таймеры стабилизации)
- Автоматический сброс приоритета при неисправности котла

## Режимы работы котлов

| Режим | Описание |
|-------|----------|
| Основной | Котел с наивысшим приоритетом, работает в режиме поддержания давления |
| Резервный | Котлы с более низким приоритетом, работают в режиме заданной мощности |

## Параметры настройки (панель ШУО)

| Параметр | По умолчанию | Описание |
|----------|--------------|----------|
| Уставка давления | 0.8 МПа | Целевое давление в паропроводе |
| Порог подключения | 3.5 МВт | Мощность основного для подключения резервного |
| Порог отключения | 1.5 МВт | Мощность основного для отключения резервного |
| Задержка подключения | 60 сек | Время ожидания перед подключением |
| Задержка отключения | 60 сек | Время ожидания перед отключением |
| Время стабилизации | 120 сек | Блокировка изменений после переключения |
| Мощность резервных | 2.5 МВт | Уставка мощности для резервных котлов |
| Скорость разгона | 0.1 МВт/сек | Скорость изменения мощности |

## Условия доступности котла

Котел считается доступным для каскада если:
1. Контроллер ШУПК на связи с ШУО
2. Выбран дистанционный режим управления
3. Отсутствуют неисправности
4. Приоритет не равен 0

## Алгоритм работы

### Включение каскада
1. Оператор нажимает "Включить"
2. Запускается котел с наивысшим приоритетом (основной)
3. Основной котел работает в режиме поддержания давления

### Подключение резервного котла
1. Мощность основного котла превышает порог подключения
2. Запускается таймер задержки подключения
3. После истечения таймера подключается резервный с наивысшим приоритетом
4. Резервный работает в режиме мощности с плавным разгоном
5. Запускается таймер стабилизации (блокировка новых переключений)

### Отключение резервного котла
1. Мощность основного котла падает ниже порога отключения
2. Запускается таймер задержки отключения
3. После истечения таймера отключается резервный с наименьшим приоритетом
4. Запускается таймер стабилизации

### Обработка неисправностей
- При потере доступности котла его приоритет автоматически сбрасывается на 0
- Если основной котел становится недоступен, роль передается следующему по приоритету
- Восстановить приоритет может только оператор

## Интеграция

### Входы от ШУПК (по сети)
- `bOnline` - статус связи
- `bRemoteMode` - режим управления (дистанционный/местный)
- `bFault` - неисправность
- `rActualPower` - текущая мощность горелки
- `bRunning` - котел работает

### Выходы на ШУПК
- `bCmdStart` - команда запуска
- `bCmdStop` - команда останова
- `bCmdPressureMode` - режим (TRUE=давление, FALSE=мощность)
- `rCmdPressure` - уставка давления
- `rCmdPower` - уставка мощности

## Импорт в Codesys

1. Создайте новый проект в Codesys
2. Добавьте DUT (Data Types) из папки `src/DUT/`
3. Добавьте FB из папки `src/FB/`
4. Добавьте программу из папки `src/PRG/`
5. Настройте привязку переменных к входам/выходам ПЛК
6. Настройте сетевой обмен с ШУПК1-ШУПК4

## Лицензия

Демонстрационный проект для Claude Code.
