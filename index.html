<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏–º—É–ª—è—Ü–∏—è –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–≤—ã–º–∏ –∫–æ—Ç–ª–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }

        .schema-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .control-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }

        /* –°—Ö–µ–º–∞ –∫–æ—Ç–µ–ª—å–Ω–æ–π */
        .boiler-house {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .steam-header {
            background: linear-gradient(90deg, #455a64, #607d8b, #455a64);
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: inset 0 -5px 15px rgba(0,0,0,0.3);
        }

        .steam-header-label {
            font-weight: bold;
            font-size: 14px;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .pressure-display {
            position: absolute;
            right: 20px;
            background: #000;
            padding: 8px 15px;
            border-radius: 8px;
            border: 2px solid #4fc3f7;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.8);
        }

        .boilers-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .boiler {
            background: linear-gradient(180deg, #37474f 0%, #263238 100%);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 2px solid #455a64;
            transition: all 0.3s ease;
            position: relative;
        }

        .boiler.running {
            border-color: #4caf50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.4);
        }

        .boiler.master {
            border-color: #ff9800;
            box-shadow: 0 0 25px rgba(255, 152, 0, 0.5);
        }

        .boiler.fault {
            border-color: #f44336;
            box-shadow: 0 0 20px rgba(244, 67, 54, 0.5);
            animation: fault-blink 1s infinite;
        }

        .boiler.unavailable {
            opacity: 0.5;
        }

        @keyframes fault-blink {
            0%, 100% { border-color: #f44336; }
            50% { border-color: #ff8a80; }
        }

        .boiler-icon {
            width: 80px;
            height: 100px;
            margin: 0 auto 10px;
            background: linear-gradient(180deg, #546e7a 0%, #37474f 100%);
            border-radius: 10px 10px 5px 5px;
            position: relative;
            border: 2px solid #607d8b;
        }

        .boiler-icon::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 20px;
            background: #455a64;
            border-radius: 5px 5px 0 0;
        }

        .flame {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 30px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .boiler.running .flame {
            opacity: 1;
            animation: flame-flicker 0.5s infinite alternate;
        }

        @keyframes flame-flicker {
            0% { transform: translateX(-50%) scale(1); }
            100% { transform: translateX(-50%) scale(1.1); }
        }

        .flame-inner {
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom, #ff9800 0%, #f44336 50%, transparent 70%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        }

        .boiler-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .boiler-status {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
            margin-bottom: 8px;
        }

        .status-off { background: #616161; }
        .status-master { background: #ff9800; color: #000; }
        .status-reserve { background: #4caf50; }
        .status-fault { background: #f44336; }

        .boiler-power {
            font-family: 'Courier New', monospace;
            font-size: 20px;
            color: #4fc3f7;
            margin: 5px 0;
        }

        .boiler-mode {
            font-size: 10px;
            color: #9e9e9e;
        }

        .pipe {
            width: 8px;
            height: 40px;
            background: linear-gradient(90deg, #455a64, #607d8b, #455a64);
            margin: 0 auto;
            position: relative;
        }

        .pipe.active::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: steam-flow 1s infinite linear;
        }

        @keyframes steam-flow {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .panel-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .panel-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .panel-title {
            font-size: 14px;
            font-weight: bold;
            color: #4fc3f7;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
            width: 100%;
            margin-bottom: 8px;
        }

        .btn-start {
            background: linear-gradient(180deg, #4caf50, #388e3c);
            color: white;
        }

        .btn-start:hover {
            background: linear-gradient(180deg, #66bb6a, #43a047);
            transform: translateY(-2px);
        }

        .btn-stop {
            background: linear-gradient(180deg, #f44336, #c62828);
            color: white;
        }

        .btn-stop:hover {
            background: linear-gradient(180deg, #ef5350, #e53935);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-demo {
            background: linear-gradient(180deg, #7c4dff, #651fff);
            color: white;
            font-size: 12px;
            padding: 10px 12px;
        }

        .btn-demo:hover {
            background: linear-gradient(180deg, #b388ff, #7c4dff);
            transform: translateY(-1px);
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .priority-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .priority-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0,0,0,0.2);
            padding: 8px 10px;
            border-radius: 6px;
        }

        .priority-item label {
            font-size: 12px;
        }

        .priority-item select {
            width: 50px;
            padding: 4px;
            border-radius: 4px;
            border: 1px solid #455a64;
            background: #263238;
            color: #fff;
        }

        .param-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .param-row label {
            font-size: 11px;
            flex: 1;
        }

        .param-row input {
            width: 70px;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #455a64;
            background: #263238;
            color: #4fc3f7;
            text-align: right;
            font-family: 'Courier New', monospace;
        }

        .param-row .unit {
            font-size: 10px;
            color: #9e9e9e;
            width: 40px;
            text-align: right;
        }

        /* –°–∏–º—É–ª—è—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ */
        .load-control {
            margin-top: 10px;
        }

        .load-slider {
            width: 100%;
            margin: 10px 0;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #4caf50, #ff9800, #f44336);
        }

        .load-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .load-display {
            text-align: center;
            font-size: 24px;
            font-family: 'Courier New', monospace;
            color: #ff9800;
        }

        /* –ì—Ä–∞—Ñ–∏–∫ */
        .chart-section {
            margin-top: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .chart-title {
            font-size: 14px;
            font-weight: bold;
            color: #4fc3f7;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chart-legend {
            display: flex;
            gap: 15px;
            font-size: 11px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 3px;
            border-radius: 2px;
        }

        .chart-container {
            background: #000;
            border-radius: 8px;
            padding: 10px;
            position: relative;
        }

        #chart {
            width: 100%;
            height: 150px;
        }

        /* –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π */
        .log-section {
            margin-top: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .log-title {
            font-size: 14px;
            font-weight: bold;
            color: #4fc3f7;
            margin-bottom: 10px;
        }

        .log-container {
            height: 120px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            background: #000;
            padding: 10px;
            border-radius: 8px;
        }

        .log-entry {
            margin-bottom: 3px;
            padding: 2px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .log-time {
            color: #9e9e9e;
        }

        .log-info { color: #4fc3f7; }
        .log-success { color: #4caf50; }
        .log-warning { color: #ff9800; }
        .log-error { color: #f44336; }

        /* –°—Ç–∞—Ç—É—Å –±–∞—Ä */
        .status-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .status-card {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .status-card-value {
            font-size: 24px;
            font-family: 'Courier New', monospace;
            color: #4fc3f7;
        }

        .status-card-label {
            font-size: 10px;
            color: #9e9e9e;
            margin-top: 5px;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ */
        .stabilization-indicator {
            background: #ff9800;
            color: #000;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            margin-top: 10px;
            display: none;
        }

        .stabilization-indicator.active {
            display: block;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* –ß–µ–∫–±–æ–∫—Å—ã –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ —Å–±–æ–µ–≤ */
        .fault-toggles {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }

        .fault-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            cursor: pointer;
        }

        .fault-toggle input {
            cursor: pointer;
        }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 10px;
            padding: 15px 20px;
            min-width: 300px;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border-left: 4px solid #4fc3f7;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .toast.success { border-left-color: #4caf50; }
        .toast.warning { border-left-color: #ff9800; }
        .toast.error { border-left-color: #f44336; }

        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 12px;
            color: #b0b0b0;
        }

        .toast-close {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            line-height: 1;
        }

        .toast-close:hover {
            color: #fff;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–∞–π–º–µ—Ä–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è */
        .timer-indicator {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            display: none;
        }

        .timer-indicator.active {
            display: block;
        }

        .timer-label {
            font-size: 11px;
            color: #9e9e9e;
            margin-bottom: 5px;
        }

        .timer-bar {
            height: 6px;
            background: #263238;
            border-radius: 3px;
            overflow: hidden;
        }

        .timer-progress {
            height: 100%;
            border-radius: 3px;
            transition: width 0.1s linear;
        }

        .timer-progress.connect {
            background: linear-gradient(90deg, #4caf50, #8bc34a);
        }

        .timer-progress.disconnect {
            background: linear-gradient(90deg, #ff9800, #ffc107);
        }
    </style>
</head>
<body>
    <!-- –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="toast-container" id="toast-container"></div>

    <div class="container">
        <h1>–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–≤—ã–º–∏ –∫–æ—Ç–ª–∞–º–∏</h1>

        <div class="main-layout">
            <div class="schema-section">
                <div class="boiler-house">
                    <!-- –û–±—â–∏–π –ø–∞—Ä–æ–ø—Ä–æ–≤–æ–¥ -->
                    <div class="steam-header">
                        <span class="steam-header-label">–û–ë–©–ò–ô –ü–ê–†–û–ü–†–û–í–û–î</span>
                        <div class="pressure-display">
                            <span id="pressure-value">0.00</span> –ú–ü–∞
                        </div>
                    </div>

                    <!-- –¢—Ä—É–±—ã –æ—Ç –∫–æ—Ç–ª–æ–≤ -->
                    <div class="boilers-row">
                        <div class="pipe" id="pipe-0"></div>
                        <div class="pipe" id="pipe-1"></div>
                        <div class="pipe" id="pipe-2"></div>
                        <div class="pipe" id="pipe-3"></div>
                    </div>

                    <!-- –ö–æ—Ç–ª—ã -->
                    <div class="boilers-row">
                        <div class="boiler" id="boiler-0">
                            <div class="boiler-icon">
                                <div class="flame"><div class="flame-inner"></div></div>
                            </div>
                            <div class="boiler-name">–ö–æ—Ç—ë–ª ‚Ññ1</div>
                            <div class="boiler-status status-off" id="status-0">–û–¢–ö–õ</div>
                            <div class="boiler-power"><span id="power-0">0.0</span> –ú–í—Ç</div>
                            <div class="boiler-mode" id="mode-0">‚Äî</div>
                        </div>
                        <div class="boiler" id="boiler-1">
                            <div class="boiler-icon">
                                <div class="flame"><div class="flame-inner"></div></div>
                            </div>
                            <div class="boiler-name">–ö–æ—Ç—ë–ª ‚Ññ2</div>
                            <div class="boiler-status status-off" id="status-1">–û–¢–ö–õ</div>
                            <div class="boiler-power"><span id="power-1">0.0</span> –ú–í—Ç</div>
                            <div class="boiler-mode" id="mode-1">‚Äî</div>
                        </div>
                        <div class="boiler" id="boiler-2">
                            <div class="boiler-icon">
                                <div class="flame"><div class="flame-inner"></div></div>
                            </div>
                            <div class="boiler-name">–ö–æ—Ç—ë–ª ‚Ññ3</div>
                            <div class="boiler-status status-off" id="status-2">–û–¢–ö–õ</div>
                            <div class="boiler-power"><span id="power-2">0.0</span> –ú–í—Ç</div>
                            <div class="boiler-mode" id="mode-2">‚Äî</div>
                        </div>
                        <div class="boiler" id="boiler-3">
                            <div class="boiler-icon">
                                <div class="flame"><div class="flame-inner"></div></div>
                            </div>
                            <div class="boiler-name">–ö–æ—Ç—ë–ª ‚Ññ4</div>
                            <div class="boiler-status status-off" id="status-3">–û–¢–ö–õ</div>
                            <div class="boiler-power"><span id="power-3">0.0</span> –ú–í—Ç</div>
                            <div class="boiler-mode" id="mode-3">‚Äî</div>
                        </div>
                    </div>

                    <!-- –°—Ç–∞—Ç—É—Å –±–∞—Ä -->
                    <div class="status-bar">
                        <div class="status-card">
                            <div class="status-card-value" id="total-power">0.0</div>
                            <div class="status-card-label">–°—É–º–º–∞—Ä–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å, –ú–í—Ç</div>
                        </div>
                        <div class="status-card">
                            <div class="status-card-value" id="active-count">0</div>
                            <div class="status-card-label">–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ç–ª–æ–≤</div>
                        </div>
                        <div class="status-card">
                            <div class="status-card-value" id="available-count">4</div>
                            <div class="status-card-label">–î–æ—Å—Ç—É–ø–Ω–æ –∫–æ—Ç–ª–æ–≤</div>
                        </div>
                        <div class="status-card">
                            <div class="status-card-value" id="master-num">‚Äî</div>
                            <div class="status-card-label">–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ç—ë–ª</div>
                        </div>
                    </div>

                    <div class="stabilization-indicator" id="stabilization">
                        ‚è≥ –°–¢–ê–ë–ò–õ–ò–ó–ê–¶–ò–Ø: <span id="stabilization-time">0</span> —Å–µ–∫
                    </div>

                    <!-- –¢–∞–π–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è -->
                    <div class="timer-indicator" id="timer-indicator">
                        <div class="timer-label" id="timer-label">–¢–∞–π–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ...</div>
                        <div class="timer-bar">
                            <div class="timer-progress connect" id="timer-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- –ì—Ä–∞—Ñ–∏–∫ -->
                <div class="chart-section">
                    <div class="chart-title">
                        <span>üìà –ì—Ä–∞—Ñ–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</span>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: #4fc3f7"></div>
                                <span>–î–∞–≤–ª–µ–Ω–∏–µ (√ó10 –ú–ü–∞)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #ff9800"></div>
                                <span>–ú–æ—â–Ω–æ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #f44336"></div>
                                <span>–ù–∞–≥—Ä—É–∑–∫–∞</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #4caf50"></div>
                                <span>–°—É–º–º–∞—Ä–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å</span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart"></canvas>
                    </div>
                </div>

                <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
                <div class="log-section">
                    <div class="log-title">üìã –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</div>
                    <div class="log-container" id="log"></div>
                </div>
            </div>

            <div class="control-panel">
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å–∫–∞–¥–æ–º -->
                <div class="panel-section">
                    <div class="panel-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å–∫–∞–¥–æ–º</div>
                    <button class="btn btn-start" id="btn-start">‚ñ∂ –í–ö–õ–Æ–ß–ò–¢–¨ –ö–ê–°–ö–ê–î</button>
                    <button class="btn btn-stop" id="btn-stop" disabled>‚ñ† –û–¢–ö–õ–Æ–ß–ò–¢–¨ –ö–ê–°–ö–ê–î</button>
                </div>

                <!-- –î–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–∏ -->
                <div class="panel-section">
                    <div class="panel-title">üé¨ –î–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–∏</div>
                    <div class="demo-grid">
                        <button class="btn btn-demo" id="demo-peak">‚ö° –ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</button>
                        <button class="btn btn-demo" id="demo-drop">üìâ –°–±—Ä–æ—Å –Ω–∞–≥—Ä—É–∑–∫–∏</button>
                        <button class="btn btn-demo" id="demo-fault">üí• –ê–≤–∞—Ä–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ</button>
                        <button class="btn btn-demo" id="demo-wave">üåä –í–æ–ª–Ω–∞ –Ω–∞–≥—Ä—É–∑–∫–∏</button>
                    </div>
                </div>

                <!-- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã -->
                <div class="panel-section">
                    <div class="panel-title">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∫–æ—Ç–ª–æ–≤</div>
                    <div class="priority-grid">
                        <div class="priority-item">
                            <label>–ö–æ—Ç—ë–ª 1</label>
                            <select id="priority-0">
                                <option value="0">0</option>
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </div>
                        <div class="priority-item">
                            <label>–ö–æ—Ç—ë–ª 2</label>
                            <select id="priority-1">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2" selected>2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </div>
                        <div class="priority-item">
                            <label>–ö–æ—Ç—ë–ª 3</label>
                            <select id="priority-2">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                            </select>
                        </div>
                        <div class="priority-item">
                            <label>–ö–æ—Ç—ë–ª 4</label>
                            <select id="priority-3">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4" selected>4</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- –°–∏–º—É–ª—è—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ -->
                <div class="panel-section">
                    <div class="panel-title">–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –ø–∞—Ä–µ</div>
                    <div class="load-display"><span id="load-value">4.0</span> –ú–í—Ç</div>
                    <input type="range" class="load-slider" id="load-slider" min="0" max="16" step="0.5" value="4">
                    <div style="display: flex; justify-content: space-between; font-size: 10px; color: #9e9e9e;">
                        <span>0 –ú–í—Ç</span>
                        <span>16 –ú–í—Ç</span>
                    </div>
                </div>

                <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                <div class="panel-section">
                    <div class="panel-title">–£—Å—Ç–∞–≤–∫–∏</div>
                    <div class="param-row">
                        <label>–î–∞–≤–ª–µ–Ω–∏–µ:</label>
                        <input type="number" id="param-pressure" value="0.8" step="0.1" min="0.1" max="2">
                        <span class="unit">–ú–ü–∞</span>
                    </div>
                    <div class="param-row">
                        <label>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏:</label>
                        <input type="number" id="param-connect" value="3.5" step="0.1" min="1" max="4">
                        <span class="unit">–ú–í—Ç</span>
                    </div>
                    <div class="param-row">
                        <label>–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏:</label>
                        <input type="number" id="param-disconnect" value="1.5" step="0.1" min="1" max="4">
                        <span class="unit">–ú–í—Ç</span>
                    </div>
                    <div class="param-row">
                        <label>–ó–∞–¥–µ—Ä–∂–∫–∞ –≤–∫–ª/–æ—Ç–∫–ª:</label>
                        <input type="number" id="param-delay" value="5" step="1" min="1" max="60">
                        <span class="unit">—Å–µ–∫</span>
                    </div>
                    <div class="param-row">
                        <label>–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è:</label>
                        <input type="number" id="param-stabilization" value="10" step="1" min="1" max="120">
                        <span class="unit">—Å–µ–∫</span>
                    </div>
                    <div class="param-row">
                        <label>–ú–æ—â–Ω–æ—Å—Ç—å —Ä–µ–∑–µ—Ä–≤–∞:</label>
                        <input type="number" id="param-reserve-power" value="2.5" step="0.1" min="1" max="4">
                        <span class="unit">–ú–í—Ç</span>
                    </div>
                </div>

                <!-- –°–∏–º—É–ª—è—Ü–∏—è —Å–±–æ–µ–≤ -->
                <div class="panel-section">
                    <div class="panel-title">–°–∏–º—É–ª—è—Ü–∏—è —Å–±–æ–µ–≤</div>
                    <div class="fault-toggles">
                        <label class="fault-toggle">
                            <input type="checkbox" id="fault-0"> –ê–≤–∞—Ä–∏—è –ö1
                        </label>
                        <label class="fault-toggle">
                            <input type="checkbox" id="fault-1"> –ê–≤–∞—Ä–∏—è –ö2
                        </label>
                        <label class="fault-toggle">
                            <input type="checkbox" id="fault-2"> –ê–≤–∞—Ä–∏—è –ö3
                        </label>
                        <label class="fault-toggle">
                            <input type="checkbox" id="fault-3"> –ê–≤–∞—Ä–∏—è –ö4
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== –°–û–°–¢–û–Ø–ù–ò–ï –°–ò–°–¢–ï–ú–´ =====
        const state = {
            cascadeEnabled: false,
            stabilizationLock: false,
            stabilizationTimer: 0,
            connectTimer: 0,
            disconnectTimer: 0,

            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
            params: {
                pressureSetpoint: 0.8,
                powerConnectThreshold: 3.5,
                powerDisconnectThreshold: 1.5,
                connectDelay: 5,
                disconnectDelay: 5,
                stabilizationTime: 10,
                reservePowerSetpoint: 2.5,
                rampRate: 0.5
            },

            steamDemand: 4.0,
            pressure: 0.0,

            boilers: [
                { priority: 1, available: true, running: false, isMaster: false, isReserve: false, power: 0, powerSetpoint: 0, fault: false },
                { priority: 2, available: true, running: false, isMaster: false, isReserve: false, power: 0, powerSetpoint: 0, fault: false },
                { priority: 3, available: true, running: false, isMaster: false, isReserve: false, power: 0, powerSetpoint: 0, fault: false },
                { priority: 4, available: true, running: false, isMaster: false, isReserve: false, power: 0, powerSetpoint: 0, fault: false }
            ],

            // –ò—Å—Ç–æ—Ä–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            chartHistory: {
                pressure: [],
                masterPower: [],
                totalPower: [],
                demand: []
            },
            chartMaxPoints: 200
        };

        // ===== –í–°–ü–õ–´–í–ê–Æ–©–ò–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø =====
        function showToast(title, message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                info: 'üí°',
                success: '‚úÖ',
                warning: '‚ö†Ô∏è',
                error: 'üö®'
            };

            toast.innerHTML = `
                <div class="toast-icon">${icons[type]}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;

            container.appendChild(toast);

            // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // ===== –õ–û–ì–ò–†–û–í–ê–ù–ò–ï =====
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log');
            const time = new Date().toLocaleTimeString('ru-RU');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
            logContainer.insertBefore(entry, logContainer.firstChild);

            while (logContainer.children.length > 100) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        // ===== –ü–û–ò–°–ö –ö–û–¢–õ–û–í =====
        function findHighestPriorityAvailable() {
            let best = -1;
            let bestPriority = 5;
            for (let i = 0; i < 4; i++) {
                const b = state.boilers[i];
                if (b.available && !b.running && b.priority > 0 && b.priority < bestPriority) {
                    bestPriority = b.priority;
                    best = i;
                }
            }
            return best;
        }

        function findLowestPriorityRunningReserve() {
            let worst = -1;
            let worstPriority = 0;
            for (let i = 0; i < 4; i++) {
                const b = state.boilers[i];
                if (b.isReserve && b.running && b.priority > worstPriority) {
                    worstPriority = b.priority;
                    worst = i;
                }
            }
            return worst;
        }

        function getMasterBoiler() {
            for (let i = 0; i < 4; i++) {
                if (state.boilers[i].isMaster && state.boilers[i].running) {
                    return i;
                }
            }
            return -1;
        }

        // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–û–¢–õ–ê–ú–ò =====
        function startBoilerAsMaster(index) {
            const b = state.boilers[index];
            b.running = true;
            b.isMaster = true;
            b.isReserve = false;
            b.powerSetpoint = 0;
            log(`–ö–æ—Ç—ë–ª ‚Ññ${index + 1} –∑–∞–ø—É—â–µ–Ω –∫–∞–∫ –û–°–ù–û–í–ù–û–ô (—Ä–µ–∂–∏–º –¥–∞–≤–ª–µ–Ω–∏—è)`, 'success');
            showToast('–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ç—ë–ª –∑–∞–ø—É—â–µ–Ω', `–ö–æ—Ç—ë–ª ‚Ññ${index + 1} —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –¥–∞–≤–ª–µ–Ω–∏—è ${state.params.pressureSetpoint} –ú–ü–∞`, 'success');
        }

        function startBoilerAsReserve(index) {
            const b = state.boilers[index];
            b.running = true;
            b.isMaster = false;
            b.isReserve = true;
            b.powerSetpoint = state.params.reservePowerSetpoint;
            log(`–ö–æ—Ç—ë–ª ‚Ññ${index + 1} –∑–∞–ø—É—â–µ–Ω –∫–∞–∫ –†–ï–ó–ï–†–í–ù–´–ô (—É—Å—Ç–∞–≤–∫–∞ ${state.params.reservePowerSetpoint} –ú–í—Ç)`, 'success');
            showToast('–†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–æ—Ç—ë–ª –ø–æ–¥–∫–ª—é—á–µ–Ω', `–ö–æ—Ç—ë–ª ‚Ññ${index + 1} –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞ –º–æ—â–Ω–æ—Å—Ç—å ${state.params.reservePowerSetpoint} –ú–í—Ç`, 'success');
            startStabilization();
        }

        function stopBoiler(index) {
            const b = state.boilers[index];
            const wasMaster = b.isMaster;
            b.running = false;
            b.isMaster = false;
            b.isReserve = false;
            b.power = 0;
            b.powerSetpoint = 0;
            log(`–ö–æ—Ç—ë–ª ‚Ññ${index + 1} –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`, 'warning');
            if (!wasMaster) {
                showToast('–†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–æ—Ç—ë–ª –æ—Ç–∫–ª—é—á–µ–Ω', `–ö–æ—Ç—ë–ª ‚Ññ${index + 1} –≤—ã–≤–µ–¥–µ–Ω –∏–∑ —Ä–∞–±–æ—Ç—ã ‚Äî –Ω–∞–≥—Ä—É–∑–∫–∞ —Å–Ω–∏–∂–µ–Ω–∞`, 'warning');
            }
        }

        function startStabilization() {
            state.stabilizationLock = true;
            state.stabilizationTimer = state.params.stabilizationTime;
            log(`–ù–∞—á–∞–ª–æ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ (${state.params.stabilizationTime} —Å–µ–∫)`, 'info');
        }

        // ===== –í–ö–õ–Æ–ß–ï–ù–ò–ï/–û–¢–ö–õ–Æ–ß–ï–ù–ò–ï –ö–ê–°–ö–ê–î–ê =====
        function enableCascade() {
            if (state.cascadeEnabled) return;

            const available = state.boilers.filter(b => b.available && b.priority > 0).length;
            if (available === 0) {
                log('–û–®–ò–ë–ö–ê: –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ—Ç–ª–æ–≤!', 'error');
                showToast('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞', '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ—Ç–ª–æ–≤ –¥–ª—è –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è', 'error');
                return;
            }

            state.cascadeEnabled = true;
            log('‚ïê‚ïê‚ïê –ö–ê–°–ö–ê–î–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ö–õ–Æ–ß–ï–ù–û ‚ïê‚ïê‚ïê', 'success');
            showToast('–ö–∞—Å–∫–∞–¥ –≤–∫–ª—é—á–µ–Ω', '–°–∏—Å—Ç–µ–º–∞ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞', 'success');

            const masterIdx = findHighestPriorityAvailable();
            if (masterIdx >= 0) {
                startBoilerAsMaster(masterIdx);
            }

            updateButtons();
        }

        function disableCascade() {
            if (!state.cascadeEnabled) return;

            state.cascadeEnabled = false;
            state.stabilizationLock = false;
            state.connectTimer = 0;
            state.disconnectTimer = 0;

            for (let i = 0; i < 4; i++) {
                if (state.boilers[i].running) {
                    stopBoiler(i);
                }
            }

            log('‚ïê‚ïê‚ïê –ö–ê–°–ö–ê–î–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–¢–ö–õ–Æ–ß–ï–ù–û ‚ïê‚ïê‚ïê', 'warning');
            showToast('–ö–∞—Å–∫–∞–¥ –æ—Ç–∫–ª—é—á–µ–Ω', '–í—Å–µ –∫–æ—Ç–ª—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã', 'warning');
            updateButtons();
        }

        // ===== –û–°–ù–û–í–ù–û–ô –¶–ò–ö–õ –°–ò–ú–£–õ–Ø–¶–ò–ò =====
        function simulationTick(dt) {
            if (!state.cascadeEnabled) {
                state.pressure = Math.max(0, state.pressure - 0.05 * dt);
                return;
            }

            // –û–±–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–æ—Ç–ª–æ–≤
            for (let i = 0; i < 4; i++) {
                const b = state.boilers[i];
                b.available = !b.fault && b.priority > 0;

                if (b.running && !b.available) {
                    log(`–ê–í–ê–†–ò–Ø: –ö–æ—Ç—ë–ª ‚Ññ${i + 1} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!`, 'error');
                    showToast('–ê–≤–∞—Ä–∏—è –∫–æ—Ç–ª–∞!', `–ö–æ—Ç—ë–ª ‚Ññ${i + 1} –≤—ã—à–µ–ª –∏–∑ —Å—Ç—Ä–æ—è. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–±—Ä–æ—à–µ–Ω –Ω–∞ 0.`, 'error');
                    b.priority = 0;
                    document.getElementById(`priority-${i}`).value = '0';

                    if (b.isMaster) {
                        stopBoiler(i);
                        const newMaster = findHighestPriorityAvailable();
                        if (newMaster >= 0) {
                            if (state.boilers[newMaster].isReserve) {
                                state.boilers[newMaster].isReserve = false;
                            }
                            showToast('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∑–µ—Ä–≤', `–ö–æ—Ç—ë–ª ‚Ññ${newMaster + 1} —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º`, 'warning');
                            startBoilerAsMaster(newMaster);
                        } else {
                            log('–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ—Ç–ª–æ–≤!', 'error');
                            showToast('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞', '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ—Ç–ª–æ–≤! –ö–∞—Å–∫–∞–¥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.', 'error');
                            disableCascade();
                            return;
                        }
                    } else {
                        stopBoiler(i);
                    }
                    startStabilization();
                }
            }

            const masterIdx = getMasterBoiler();
            if (masterIdx < 0) return;

            const master = state.boilers[masterIdx];

            let reservePower = 0;
            for (let i = 0; i < 4; i++) {
                if (state.boilers[i].isReserve && state.boilers[i].running) {
                    reservePower += state.boilers[i].power;
                }
            }

            const pressureError = state.params.pressureSetpoint - state.pressure;
            const masterRequired = Math.max(1, Math.min(4, state.steamDemand - reservePower + pressureError * 5));

            if (master.power < masterRequired) {
                master.power = Math.min(4, master.power + 2 * dt);
            } else {
                master.power = Math.max(1, master.power - 2 * dt);
            }

            // Ramping —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö
            for (let i = 0; i < 4; i++) {
                const b = state.boilers[i];
                if (b.isReserve && b.running) {
                    if (b.power < b.powerSetpoint) {
                        b.power = Math.min(b.powerSetpoint, b.power + state.params.rampRate * dt);
                    }
                }
            }

            // –î–∞–≤–ª–µ–Ω–∏–µ
            const totalPower = state.boilers.reduce((sum, b) => sum + (b.running ? b.power : 0), 0);
            const pressureDelta = (totalPower - state.steamDemand) * 0.02;
            state.pressure = Math.max(0, Math.min(1.5, state.pressure + pressureDelta * dt));

            // –õ–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è
            if (!state.stabilizationLock) {
                // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                if (master.power >= state.params.powerConnectThreshold) {
                    state.connectTimer += dt;
                    if (state.connectTimer >= state.params.connectDelay) {
                        const nextReserve = findHighestPriorityAvailable();
                        if (nextReserve >= 0) {
                            startBoilerAsReserve(nextReserve);
                        }
                        state.connectTimer = 0;
                    }
                } else {
                    state.connectTimer = 0;
                }

                // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ
                const hasRunningReserves = state.boilers.some(b => b.isReserve && b.running);
                if (master.power <= state.params.powerDisconnectThreshold && hasRunningReserves) {
                    state.disconnectTimer += dt;
                    if (state.disconnectTimer >= state.params.disconnectDelay) {
                        const reserveToStop = findLowestPriorityRunningReserve();
                        if (reserveToStop >= 0) {
                            stopBoiler(reserveToStop);
                            startStabilization();
                        }
                        state.disconnectTimer = 0;
                    }
                } else {
                    state.disconnectTimer = 0;
                }
            }

            // –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è
            if (state.stabilizationLock) {
                state.stabilizationTimer -= dt;
                if (state.stabilizationTimer <= 0) {
                    state.stabilizationLock = false;
                    state.stabilizationTimer = 0;
                    log('–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'info');
                }
            }
        }

        // ===== –ì–†–ê–§–ò–ö =====
        function updateChart() {
            const canvas = document.getElementById('chart');
            const ctx = canvas.getContext('2d');

            // –†–∞–∑–º–µ—Ä—ã
            canvas.width = canvas.offsetWidth * 2;
            canvas.height = canvas.offsetHeight * 2;
            ctx.scale(2, 2);

            const w = canvas.offsetWidth;
            const h = canvas.offsetHeight;
            const padding = { left: 40, right: 10, top: 10, bottom: 20 };
            const chartW = w - padding.left - padding.right;
            const chartH = h - padding.top - padding.bottom;

            // –û—á–∏—Å—Ç–∫–∞
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, w, h);

            // –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
            const masterIdx = getMasterBoiler();
            const masterPower = masterIdx >= 0 ? state.boilers[masterIdx].power : 0;
            const totalPower = state.boilers.reduce((sum, b) => sum + (b.running ? b.power : 0), 0);

            state.chartHistory.pressure.push(state.pressure * 10);
            state.chartHistory.masterPower.push(masterPower);
            state.chartHistory.totalPower.push(totalPower);
            state.chartHistory.demand.push(state.steamDemand);

            // –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
            Object.keys(state.chartHistory).forEach(key => {
                while (state.chartHistory[key].length > state.chartMaxPoints) {
                    state.chartHistory[key].shift();
                }
            });

            // –°–µ—Ç–∫–∞
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = padding.top + (chartH / 4) * i;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(w - padding.right, y);
                ctx.stroke();
            }

            // –ü–æ–¥–ø–∏—Å–∏ –æ—Å–∏ Y
            ctx.fillStyle = '#666';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 4; i++) {
                const val = 16 - i * 4;
                const y = padding.top + (chartH / 4) * i;
                ctx.fillText(val.toString(), padding.left - 5, y + 3);
            }

            // –õ–∏–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞
            function drawLine(data, color) {
                if (data.length < 2) return;
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                data.forEach((val, i) => {
                    const x = padding.left + (i / (state.chartMaxPoints - 1)) * chartW;
                    const y = padding.top + chartH - (val / 16) * chartH;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();
            }

            drawLine(state.chartHistory.demand, '#f44336');
            drawLine(state.chartHistory.totalPower, '#4caf50');
            drawLine(state.chartHistory.masterPower, '#ff9800');
            drawLine(state.chartHistory.pressure, '#4fc3f7');

            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = 'rgba(76, 175, 80, 0.5)';
            ctx.lineWidth = 1;
            let thresholdY = padding.top + chartH - (state.params.powerConnectThreshold / 16) * chartH;
            ctx.beginPath();
            ctx.moveTo(padding.left, thresholdY);
            ctx.lineTo(w - padding.right, thresholdY);
            ctx.stroke();

            ctx.strokeStyle = 'rgba(255, 152, 0, 0.5)';
            thresholdY = padding.top + chartH - (state.params.powerDisconnectThreshold / 16) * chartH;
            ctx.beginPath();
            ctx.moveTo(padding.left, thresholdY);
            ctx.lineTo(w - padding.right, thresholdY);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        // ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï UI =====
        function updateUI() {
            document.getElementById('pressure-value').textContent = state.pressure.toFixed(2);

            let totalPower = 0;
            let activeCount = 0;
            let availableCount = 0;
            let masterNum = '‚Äî';

            for (let i = 0; i < 4; i++) {
                const b = state.boilers[i];
                const boilerEl = document.getElementById(`boiler-${i}`);
                const statusEl = document.getElementById(`status-${i}`);
                const powerEl = document.getElementById(`power-${i}`);
                const modeEl = document.getElementById(`mode-${i}`);
                const pipeEl = document.getElementById(`pipe-${i}`);

                boilerEl.className = 'boiler';
                if (b.fault) {
                    boilerEl.classList.add('fault');
                } else if (!b.available) {
                    boilerEl.classList.add('unavailable');
                } else if (b.isMaster && b.running) {
                    boilerEl.classList.add('running', 'master');
                } else if (b.running) {
                    boilerEl.classList.add('running');
                }

                if (b.fault) {
                    statusEl.textContent = '–ê–í–ê–†–ò–Ø';
                    statusEl.className = 'boiler-status status-fault';
                } else if (b.isMaster && b.running) {
                    statusEl.textContent = '–û–°–ù–û–í–ù–û–ô';
                    statusEl.className = 'boiler-status status-master';
                    masterNum = `‚Ññ${i + 1}`;
                } else if (b.isReserve && b.running) {
                    statusEl.textContent = '–†–ï–ó–ï–†–í–ù–´–ô';
                    statusEl.className = 'boiler-status status-reserve';
                } else {
                    statusEl.textContent = '–û–¢–ö–õ';
                    statusEl.className = 'boiler-status status-off';
                }

                powerEl.textContent = b.power.toFixed(1);

                if (b.isMaster && b.running) {
                    modeEl.textContent = `–†–µ–∂–∏–º –¥–∞–≤–ª–µ–Ω–∏—è (${state.params.pressureSetpoint} –ú–ü–∞)`;
                } else if (b.isReserve && b.running) {
                    modeEl.textContent = `–†–µ–∂–∏–º –º–æ—â–Ω–æ—Å—Ç–∏ (‚Üí${b.powerSetpoint.toFixed(1)} –ú–í—Ç)`;
                } else {
                    modeEl.textContent = '‚Äî';
                }

                pipeEl.className = b.running ? 'pipe active' : 'pipe';

                if (b.running) {
                    totalPower += b.power;
                    activeCount++;
                }
                if (b.available) {
                    availableCount++;
                }
            }

            document.getElementById('total-power').textContent = totalPower.toFixed(1);
            document.getElementById('active-count').textContent = activeCount;
            document.getElementById('available-count').textContent = availableCount;
            document.getElementById('master-num').textContent = masterNum;

            // –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è
            const stabEl = document.getElementById('stabilization');
            if (state.stabilizationLock) {
                stabEl.classList.add('active');
                document.getElementById('stabilization-time').textContent = Math.ceil(state.stabilizationTimer);
            } else {
                stabEl.classList.remove('active');
            }

            // –¢–∞–π–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è
            const timerEl = document.getElementById('timer-indicator');
            const timerLabel = document.getElementById('timer-label');
            const timerProgress = document.getElementById('timer-progress');

            if (state.connectTimer > 0 && !state.stabilizationLock) {
                timerEl.classList.add('active');
                timerLabel.textContent = `–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —á–µ—Ä–µ–∑ ${Math.ceil(state.params.connectDelay - state.connectTimer)} —Å–µ–∫...`;
                timerProgress.style.width = (state.connectTimer / state.params.connectDelay * 100) + '%';
                timerProgress.className = 'timer-progress connect';
            } else if (state.disconnectTimer > 0 && !state.stabilizationLock) {
                timerEl.classList.add('active');
                timerLabel.textContent = `–û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —á–µ—Ä–µ–∑ ${Math.ceil(state.params.disconnectDelay - state.disconnectTimer)} —Å–µ–∫...`;
                timerProgress.style.width = (state.disconnectTimer / state.params.disconnectDelay * 100) + '%';
                timerProgress.className = 'timer-progress disconnect';
            } else {
                timerEl.classList.remove('active');
            }
        }

        function updateButtons() {
            document.getElementById('btn-start').disabled = state.cascadeEnabled;
            document.getElementById('btn-stop').disabled = !state.cascadeEnabled;
        }

        // ===== –î–ï–ú–û-–°–¶–ï–ù–ê–†–ò–ò =====
        function demoPeakLoad() {
            if (!state.cascadeEnabled) {
                enableCascade();
            }
            showToast('–°—Ü–µ–Ω–∞—Ä–∏–π: –ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞', '–ù–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑–∫–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–æ 14 –ú–í—Ç', 'info');
            setTimeout(() => {
                state.steamDemand = 14;
                document.getElementById('load-slider').value = 14;
                document.getElementById('load-value').textContent = '14.0';
            }, 1000);
        }

        function demoLoadDrop() {
            if (!state.cascadeEnabled) {
                enableCascade();
            }
            showToast('–°—Ü–µ–Ω–∞—Ä–∏–π: –°–±—Ä–æ—Å –Ω–∞–≥—Ä—É–∑–∫–∏', '–ù–∞–≥—Ä—É–∑–∫–∞ –ø–∞–¥–∞–µ—Ç –¥–æ 2 –ú–í—Ç ‚Äî —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–∫–ª—é—á–∞—Ç—å—Å—è', 'info');
            state.steamDemand = 2;
            document.getElementById('load-slider').value = 2;
            document.getElementById('load-value').textContent = '2.0';
        }

        function demoMasterFault() {
            if (!state.cascadeEnabled) {
                enableCascade();
                setTimeout(demoMasterFault, 2000);
                return;
            }
            const masterIdx = getMasterBoiler();
            if (masterIdx >= 0) {
                showToast('–°—Ü–µ–Ω–∞—Ä–∏–π: –ê–≤–∞—Ä–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ', `–°–∏–º—É–ª—è—Ü–∏—è –∞–≤–∞—Ä–∏–∏ –∫–æ—Ç–ª–∞ ‚Ññ${masterIdx + 1}`, 'error');
                state.boilers[masterIdx].fault = true;
                document.getElementById(`fault-${masterIdx}`).checked = true;
            }
        }

        let waveInterval = null;
        function demoLoadWave() {
            if (!state.cascadeEnabled) {
                enableCascade();
            }
            showToast('–°—Ü–µ–Ω–∞—Ä–∏–π: –í–æ–ª–Ω–∞ –Ω–∞–≥—Ä—É–∑–∫–∏', '–ù–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–≤–Ω–æ –∫–æ–ª–µ–±–ª–µ—Ç—Å—è 2‚Üí12‚Üí2 –ú–í—Ç (30 —Å–µ–∫)', 'info');

            if (waveInterval) clearInterval(waveInterval);

            let t = 0;
            waveInterval = setInterval(() => {
                t += 0.1;
                const load = 7 + 5 * Math.sin(t * 0.5);
                state.steamDemand = load;
                document.getElementById('load-slider').value = load;
                document.getElementById('load-value').textContent = load.toFixed(1);

                if (t > 30) {
                    clearInterval(waveInterval);
                    waveInterval = null;
                }
            }, 100);
        }

        // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô =====
        document.getElementById('btn-start').addEventListener('click', enableCascade);
        document.getElementById('btn-stop').addEventListener('click', disableCascade);

        document.getElementById('demo-peak').addEventListener('click', demoPeakLoad);
        document.getElementById('demo-drop').addEventListener('click', demoLoadDrop);
        document.getElementById('demo-fault').addEventListener('click', demoMasterFault);
        document.getElementById('demo-wave').addEventListener('click', demoLoadWave);

        document.getElementById('load-slider').addEventListener('input', (e) => {
            state.steamDemand = parseFloat(e.target.value);
            document.getElementById('load-value').textContent = state.steamDemand.toFixed(1);
        });

        for (let i = 0; i < 4; i++) {
            document.getElementById(`priority-${i}`).addEventListener('change', (e) => {
                state.boilers[i].priority = parseInt(e.target.value);
                state.boilers[i].available = !state.boilers[i].fault && state.boilers[i].priority > 0;
                log(`–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–æ—Ç–ª–∞ ‚Ññ${i + 1} –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ ${e.target.value}`, 'info');
            });
        }

        document.getElementById('param-pressure').addEventListener('change', (e) => {
            state.params.pressureSetpoint = parseFloat(e.target.value);
        });
        document.getElementById('param-connect').addEventListener('change', (e) => {
            state.params.powerConnectThreshold = parseFloat(e.target.value);
        });
        document.getElementById('param-disconnect').addEventListener('change', (e) => {
            state.params.powerDisconnectThreshold = parseFloat(e.target.value);
        });
        document.getElementById('param-delay').addEventListener('change', (e) => {
            state.params.connectDelay = parseInt(e.target.value);
            state.params.disconnectDelay = parseInt(e.target.value);
        });
        document.getElementById('param-stabilization').addEventListener('change', (e) => {
            state.params.stabilizationTime = parseInt(e.target.value);
        });
        document.getElementById('param-reserve-power').addEventListener('change', (e) => {
            state.params.reservePowerSetpoint = parseFloat(e.target.value);
        });

        for (let i = 0; i < 4; i++) {
            document.getElementById(`fault-${i}`).addEventListener('change', (e) => {
                state.boilers[i].fault = e.target.checked;
                if (e.target.checked) {
                    log(`–°–ò–ú–£–õ–Ø–¶–ò–Ø: –ê–≤–∞—Ä–∏—è –∫–æ—Ç–ª–∞ ‚Ññ${i + 1}`, 'error');
                } else {
                    log(`–°–ò–ú–£–õ–Ø–¶–ò–Ø: –ê–≤–∞—Ä–∏—è –∫–æ—Ç–ª–∞ ‚Ññ${i + 1} —Å–Ω—è—Ç–∞`, 'info');
                    state.boilers[i].available = state.boilers[i].priority > 0;
                }
            });
        }

        // ===== –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ =====
        let lastTime = Date.now();

        function mainLoop() {
            const now = Date.now();
            const dt = (now - lastTime) / 1000;
            lastTime = now;

            simulationTick(dt);
            updateUI();
            updateChart();

            requestAnimationFrame(mainLoop);
        }

        // –ó–∞–ø—É—Å–∫
        log('–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'info');
        log('–ù–∞–∂–º–∏—Ç–µ "–í–ö–õ–Æ–ß–ò–¢–¨ –ö–ê–°–ö–ê–î" –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–π', 'info');
        showToast('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', '–ù–∞–∂–º–∏—Ç–µ "–í–ö–õ–Æ–ß–ò–¢–¨ –ö–ê–°–ö–ê–î" –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –Ω–∞—á–∞–ª–∞', 'info');
        mainLoop();
    </script>
</body>
</html>
